<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Crawler</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
    }
    .glass {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .crawl-animation {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .spinner {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .dots::after {
      content: '';
      animation: dots 1.5s steps(4, end) infinite;
    }
    @keyframes dots {
      0%, 20% { content: ''; }
      40% { content: '.'; }
      60% { content: '..'; }
      80%, 100% { content: '...'; }
    }
    .table-container::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .table-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }
    .table-container::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }
    .table-container::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    const API_BASE = window.location.origin;

    // IndexedDB Helper
    const DB_NAME = 'WebCrawlerDB';
    const DB_VERSION = 1;
    const STORE_NAME = 'crawls';

    const initDB = () => {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => resolve(request.result);
        
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          if (!db.objectStoreNames.contains(STORE_NAME)) {
            const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
            objectStore.createIndex('sessionId', 'sessionId', { unique: true });
            objectStore.createIndex('timestamp', 'timestamp', { unique: false });
            objectStore.createIndex('domain', 'domain', { unique: false });
          }
        };
      });
    };

    const saveCrawlToDB = async (crawlData) => {
      const db = await initDB();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.add(crawlData);
        
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    };

    const updateCrawlInDB = async (sessionId, updates) => {
      const db = await initDB();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
        const index = store.index('sessionId');
        const request = index.get(sessionId);
        
        request.onsuccess = () => {
          const crawl = request.result;
          if (crawl) {
            Object.assign(crawl, updates);
            store.put(crawl);
            resolve(crawl);
          } else {
            reject(new Error('Crawl not found'));
          }
        };
        request.onerror = () => reject(request.error);
      });
    };

    const getAllCrawls = async () => {
      const db = await initDB();
      return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readonly');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.getAll();
        
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    };

    function App() {
      const [domain, setDomain] = useState('');
      const [sessionId, setSessionId] = useState(null);
      const [status, setStatus] = useState(null);
      const [pages, setPages] = useState([]);
      const [pagination, setPagination] = useState(null);
      const [currentPage, setCurrentPage] = useState(1);
      const [searchTerm, setSearchTerm] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState(null);
      const [linkFilter, setLinkFilter] = useState('all'); // 'dead', 'healthy', 'all'
      const [linkCounts, setLinkCounts] = useState({ dead: 0, healthy: 0, all: 0 }); // Track counts
      const [showSitemapModal, setShowSitemapModal] = useState(false);
      const [showScheduleModal, setShowScheduleModal] = useState(false);
      const [sitemapOptions, setSitemapOptions] = useState({ type: 'all', priority: 'manual' }); // type: 'all'|'healthy', priority: 'manual'|'intelligent'

      // Initialize IndexedDB on mount
      useEffect(() => {
        initDB().catch(err => console.error('Failed to initialize IndexedDB:', err));
      }, []);

      // Fetch status periodically while crawling
      useEffect(() => {
        if (!sessionId) return;
        
        const fetchStatus = async () => {
          try {
            const res = await fetch(`${API_BASE}/api/crawl/${sessionId}/status`);
            const data = await res.json();
            setStatus(data);
            
            if (!data.isRunning) {
              // Crawl finished, fetch final pages with current filter
              fetchPages(1, searchTerm, linkFilter);
              // Update in IndexedDB
              updateCrawlInDB(sessionId, {
                status: 'completed',
                completedAt: new Date().toISOString(),
                pagesFound: data.pagesFound,
                errors: data.errors
              }).catch(err => console.error('Failed to update crawl in DB:', err));
            }
          } catch (err) {
            console.error('Error fetching status:', err);
          }
        };

        fetchStatus();
        const interval = setInterval(fetchStatus, 1000);
        return () => clearInterval(interval);
      }, [sessionId, linkFilter, searchTerm, fetchPages]);

      // Fetch pages
      const fetchPages = useCallback(async (page, search = searchTerm, filter = linkFilter) => {
        if (!sessionId) return;
        
        try {
          const res = await fetch(
            `${API_BASE}/api/crawl/${sessionId}/pages?page=${page}&limit=1000&search=${encodeURIComponent(search)}&filter=${filter}`
          );
          const data = await res.json();
          setPages(data.pages);
          setPagination(data.pagination);
          setCurrentPage(page);
          
          // Fetch counts for all filters
          const [deadRes, healthyRes, allRes] = await Promise.all([
            fetch(`${API_BASE}/api/crawl/${sessionId}/pages?page=1&limit=1&filter=dead`),
            fetch(`${API_BASE}/api/crawl/${sessionId}/pages?page=1&limit=1&filter=healthy`),
            fetch(`${API_BASE}/api/crawl/${sessionId}/pages?page=1&limit=1&filter=all`)
          ]);
          
          const [deadData, healthyData, allData] = await Promise.all([
            deadRes.json(),
            healthyRes.json(),
            allRes.json()
          ]);
          
          setLinkCounts({
            dead: deadData.pagination.totalItems,
            healthy: healthyData.pagination.totalItems,
            all: allData.pagination.totalItems
          });
        } catch (err) {
          console.error('Error fetching pages:', err);
        }
      }, [sessionId, searchTerm, linkFilter]);

      // Start crawling
      const startCrawl = async () => {
        if (!domain.trim()) {
          setError('Please enter a domain');
          return;
        }

        setError(null);
        setIsLoading(true);
        setPages([]);
        setPagination(null);
        setStatus(null);

        try {
          const res = await fetch(`${API_BASE}/api/crawl`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ domain: domain.trim(), maxPages: 10000 })
          });
          
          if (!res.ok) {
            throw new Error('Failed to start crawl');
          }
          
          const data = await res.json();
          setSessionId(data.sessionId);
          
          // Save to IndexedDB
          saveCrawlToDB({
            sessionId: data.sessionId,
            domain: domain.trim(),
            timestamp: new Date().toISOString(),
            status: 'running',
            pagesFound: 0,
            errors: 0
          }).catch(err => console.error('Failed to save crawl to DB:', err));
        } catch (err) {
          setError(err.message);
        } finally {
          setIsLoading(false);
        }
      };

      // Stop crawling
      const stopCrawl = async () => {
        if (!sessionId) return;
        
        try {
          await fetch(`${API_BASE}/api/crawl/${sessionId}/stop`, { method: 'POST' });
          fetchPages(1, searchTerm, linkFilter);
          // Update in IndexedDB
          updateCrawlInDB(sessionId, {
            status: 'stopped',
            stoppedAt: new Date().toISOString()
          }).catch(err => console.error('Failed to update crawl in DB:', err));
        } catch (err) {
          console.error('Error stopping crawl:', err);
        }
      };

      // Handle search
      const handleSearch = (e) => {
        const value = e.target.value;
        setSearchTerm(value);
        // Debounce search
        clearTimeout(window.searchTimeout);
        window.searchTimeout = setTimeout(() => {
          fetchPages(1, value, linkFilter);
        }, 300);
      };

      // Handle filter change
      const handleFilterChange = (filter) => {
        setLinkFilter(filter);
        fetchPages(1, searchTerm, filter);
      };

      // Pagination controls
      const goToPage = (page) => {
        if (page >= 1 && page <= (pagination?.totalPages || 1)) {
          fetchPages(page, searchTerm, linkFilter);
        }
      };

      // Generate sitemap
      const generateSitemap = async () => {
        if (!sessionId) return;
        
        try {
          const res = await fetch(
            `${API_BASE}/api/crawl/${sessionId}/sitemap?type=${sitemapOptions.type}&priority=${sitemapOptions.priority}`
          );
          const blob = await res.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `sitemap-${sitemapOptions.type}-${sitemapOptions.priority}.xml`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
          setShowSitemapModal(false);
        } catch (err) {
          console.error('Error generating sitemap:', err);
          alert('Failed to generate sitemap');
        }
      };

      return (
        <div className="min-h-screen p-4 md:p-8">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="text-center mb-8">
              <h1 className="text-4xl md:text-5xl font-bold text-white mb-2">
                <i className="fas fa-spider mr-3 text-purple-400"></i>
                Web Crawler
              </h1>
              <p className="text-gray-400">Discover all pages and their status on any website</p>
              <a
                href="/previous-crawls.html"
                className="mt-4 inline-block text-purple-400 hover:text-purple-300 transition-colors"
              >
                <i className="fas fa-history mr-2"></i>View Previous Crawls
              </a>
            </div>

            {/* Search Input */}
            <div className="glass rounded-2xl p-6 mb-6">
              <div className="flex flex-col md:flex-row gap-4">
                <div className="flex-1">
                  <label className="block text-gray-400 text-sm mb-2">Enter Domain</label>
                  <input
                    type="text"
                    value={domain}
                    onChange={(e) => setDomain(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && startCrawl()}
                    placeholder="example.com"
                    className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 transition-colors"
                    disabled={status?.isRunning}
                  />
                </div>
                <div className="flex items-end gap-2">
                  {!status?.isRunning ? (
                    <button
                      onClick={startCrawl}
                      disabled={isLoading || !domain.trim()}
                      className="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold px-8 py-3 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {isLoading ? (
                        <><i className="fas fa-spinner spinner mr-2"></i>Starting...</>
                      ) : (
                        <><i className="fas fa-play mr-2"></i>Start Crawl</>
                      )}
                    </button>
                  ) : (
                    <>
                      <button
                        disabled={true}
                        className="bg-gradient-to-r from-purple-600/50 to-blue-600/50 text-white font-semibold px-8 py-3 rounded-xl cursor-not-allowed opacity-75"
                      >
                        <i className="fas fa-spinner spinner mr-2"></i>
                        <span className="dots">Crawling</span>
                      </button>
                      <button
                        onClick={stopCrawl}
                        className="bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-semibold px-6 py-3 rounded-xl transition-all"
                      >
                        <i className="fas fa-stop mr-2"></i>Stop
                      </button>
                    </>
                  )}
                </div>
              </div>
              
              {error && (
                <div className="mt-4 bg-red-500/20 border border-red-500/50 rounded-xl p-4 text-red-300">
                  <i className="fas fa-exclamation-circle mr-2"></i>{error}
                </div>
              )}
            </div>

            {/* Status Panel */}
            {status && (
              <div className="glass rounded-2xl p-6 mb-6">
                <div className="flex flex-wrap items-center justify-between gap-4">
                  <div className="flex items-center gap-6">
                    <div className="text-center">
                      <div className="text-3xl font-bold text-green-400">{status.pagesFound.toLocaleString()}</div>
                      <div className="text-gray-400 text-sm">Pages Found</div>
                    </div>
                    <div className="text-center">
                      <div className="text-3xl font-bold text-blue-400">{status.pagesQueued.toLocaleString()}</div>
                      <div className="text-gray-400 text-sm">In Queue</div>
                    </div>
                    <div className="text-center">
                      <div className="text-3xl font-bold text-red-400">{status.errors}</div>
                      <div className="text-gray-400 text-sm">Errors</div>
                    </div>
                  </div>
                  
                  <div className="flex flex-col items-end gap-2">
                    {status.isRunning && status.currentUrl && (
                      <div className="text-gray-400 text-xs max-w-md truncate">
                        <i className="fas fa-link mr-1"></i>
                        <span className="text-purple-400">{status.currentUrl}</span>
                      </div>
                    )}
                    
                    <div className="flex items-center gap-4">
                      {status.isRunning ? (
                        <div className="bg-gradient-to-r from-green-600 to-teal-600 text-white font-semibold px-6 py-3 rounded-xl inline-flex items-center">
                          <i className="fas fa-circle-notch fa-spin mr-2"></i>
                          Crawling...
                        </div>
                      ) : (
                        status.pagesFound > 0 && (
                          <div className="flex gap-3">
                            <a
                              href={`${API_BASE}/api/crawl/${sessionId}/download?filter=${linkFilter}`}
                              className="bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-semibold px-6 py-3 rounded-xl transition-all inline-flex items-center"
                            >
                              <i className="fas fa-download mr-2"></i>
                              Download CSV ({linkFilter === 'dead' ? 'Dead Links' : linkFilter === 'healthy' ? 'Healthy Links' : 'All Links'})
                            </a>
                            <button
                              onClick={() => setShowSitemapModal(true)}
                              className="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold px-6 py-3 rounded-xl transition-all inline-flex items-center"
                            >
                              <i className="fas fa-sitemap mr-2"></i>
                              Generate Sitemap
                            </button>
                            <button
                              onClick={() => setShowScheduleModal(true)}
                              className="bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-700 hover:to-amber-700 text-white font-semibold px-6 py-3 rounded-xl transition-all inline-flex items-center relative"
                            >
                              <i className="fas fa-calendar-alt mr-2"></i>
                              Schedule Scans
                              <span className="absolute -top-2 -right-2 bg-yellow-500 text-black text-xs font-bold px-2 py-1 rounded-full">Soon</span>
                            </button>
                          </div>
                        )
                      )}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Results Table */}
            {status && status.pagesFound > 0 && (
              <div className="glass rounded-2xl overflow-hidden">
                {/* Table Header */}
                <div className="p-4 border-b border-white/10 flex flex-col gap-4">
                  <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <h2 className="text-xl font-semibold text-white">
                      <i className="fas fa-list mr-2 text-purple-400"></i>
                      Discovered Pages
                    </h2>
                    
                    <div className="flex items-center gap-4 w-full md:w-auto">
                      <div className="relative flex-1 md:w-64">
                        <input
                          type="text"
                          value={searchTerm}
                          onChange={handleSearch}
                          placeholder="Search URLs..."
                          className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 pl-10 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500"
                        />
                        <i className="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                      </div>
                    </div>
                  </div>
                  
                  {/* Filter Buttons */}
                  <div className="flex gap-2 flex-wrap">
                    <button
                      onClick={() => handleFilterChange('all')}
                      className={`px-4 py-2 rounded-lg font-medium transition-all ${
                        linkFilter === 'all'
                          ? 'bg-purple-600 text-white'
                          : 'bg-white/5 text-gray-400 hover:bg-white/10'
                      }`}
                    >
                      <i className="fas fa-globe mr-2"></i>
                      All URLs {linkCounts.all > 0 && `(${linkCounts.all})`}
                    </button>
                    <button
                      onClick={() => handleFilterChange('dead')}
                      className={`px-4 py-2 rounded-lg font-medium transition-all ${
                        linkFilter === 'dead'
                          ? 'bg-red-600 text-white'
                          : 'bg-white/5 text-gray-400 hover:bg-white/10'
                      }`}
                    >
                      <i className="fas fa-times-circle mr-2"></i>
                      Dead Links {linkCounts.dead > 0 && `(${linkCounts.dead})`}
                    </button>
                    <button
                      onClick={() => handleFilterChange('healthy')}
                      className={`px-4 py-2 rounded-lg font-medium transition-all ${
                        linkFilter === 'healthy'
                          ? 'bg-green-600 text-white'
                          : 'bg-white/5 text-gray-400 hover:bg-white/10'
                      }`}
                    >
                      <i className="fas fa-check-circle mr-2"></i>
                      Healthy Links {linkCounts.healthy > 0 && `(${linkCounts.healthy})`}
                    </button>
                  </div>
                </div>

                {/* Table Content or Empty State */}
                {pages.length > 0 ? (
                  <div className="table-container overflow-x-auto max-h-[600px] overflow-y-auto">
                    <table className="w-full">
                      <thead className="bg-white/5 sticky top-0">
                        <tr>
                          <th className="text-left text-gray-400 font-medium px-4 py-3 text-sm">#</th>
                          <th className="text-left text-gray-400 font-medium px-4 py-3 text-sm">URL</th>
                          <th className="text-left text-gray-400 font-medium px-4 py-3 text-sm">Title</th>
                          <th className="text-left text-gray-400 font-medium px-4 py-3 text-sm">Status</th>
                        </tr>
                      </thead>
                      <tbody>
                      {pages.map((page, index) => (
                        <tr key={page.url} className="border-t border-white/5 hover:bg-white/5 transition-colors">
                          <td className="px-4 py-3 text-gray-500 text-sm">
                            {(currentPage - 1) * 1000 + index + 1}
                          </td>
                          <td className="px-4 py-3">
                            <a
                              href={page.url}
                              target="_blank"
                              rel="noopener noreferrer"
                              className="text-blue-400 hover:text-blue-300 hover:underline text-sm break-all"
                            >
                              {page.url}
                            </a>
                          </td>
                          <td className="px-4 py-3 text-gray-300 text-sm max-w-xs truncate">
                            {page.title}
                          </td>
                          <td className="px-4 py-3">
                            <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                              page.status === 'success' 
                                ? 'bg-green-500/20 text-green-400' 
                                : page.status === 'non-html'
                                ? 'bg-yellow-500/20 text-yellow-400'
                                : 'bg-red-500/20 text-red-400'
                            }`}>
                              {page.status === 'success' ? (
                                <><i className="fas fa-check mr-1"></i>OK</>
                              ) : page.status === 'non-html' ? (
                                <><i className="fas fa-file mr-1"></i>Non-HTML</>
                              ) : (
                                <><i className="fas fa-times mr-1"></i>Error</>
                              )}
                            </span>
                          </td>
                        </tr>
                      ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <div className="table-container p-12 text-center">
                    <div className="text-gray-500">
                      <i className="fas fa-inbox text-4xl mb-3 block"></i>
                      <p className="text-lg">No pages found matching the selected filter</p>
                      {linkFilter !== 'all' && (
                        <button
                          onClick={() => handleFilterChange('all')}
                          className="mt-4 text-purple-400 hover:text-purple-300 underline"
                        >
                          View all pages
                        </button>
                      )}
                    </div>
                  </div>
                )}

                {/* Pagination */}
                {pagination && pagination.totalPages > 1 && (
                  <div className="p-4 border-t border-white/10 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="text-gray-400 text-sm">
                      Showing {((currentPage - 1) * 1000) + 1} - {Math.min(currentPage * 1000, pagination.totalItems)} of {pagination.totalItems.toLocaleString()} pages
                    </div>
                    
                    <div className="flex items-center gap-2">
                      <button
                        onClick={() => goToPage(1)}
                        disabled={currentPage === 1}
                        className="px-3 py-2 rounded-lg bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                      >
                        <i className="fas fa-angle-double-left"></i>
                      </button>
                      <button
                        onClick={() => goToPage(currentPage - 1)}
                        disabled={currentPage === 1}
                        className="px-3 py-2 rounded-lg bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                      >
                        <i className="fas fa-angle-left"></i>
                      </button>
                      
                      <span className="px-4 py-2 text-white">
                        Page {currentPage} of {pagination.totalPages}
                      </span>
                      
                      <button
                        onClick={() => goToPage(currentPage + 1)}
                        disabled={currentPage === pagination.totalPages}
                        className="px-3 py-2 rounded-lg bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                      >
                        <i className="fas fa-angle-right"></i>
                      </button>
                      <button
                        onClick={() => goToPage(pagination.totalPages)}
                        disabled={currentPage === pagination.totalPages}
                        className="px-3 py-2 rounded-lg bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                      >
                        <i className="fas fa-angle-double-right"></i>
                      </button>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* Empty State */}
            {!status && !isLoading && (
              <div className="glass rounded-2xl p-12 text-center">
                <i className="fas fa-globe text-6xl text-purple-400/50 mb-4"></i>
                <h3 className="text-xl text-gray-300 mb-2">Ready to crawl</h3>
                <p className="text-gray-500">Enter a domain above to discover all its pages</p>
              </div>
            )}

            {/* Footer */}
            <div className="text-center mt-8 text-gray-500 text-sm">
              <p>Web Crawler respects robots.txt and uses polite crawling with delays</p>
            </div>

            {/* Sitemap Generation Modal */}
            {showSitemapModal && (
              <div 
                className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50"
                onClick={() => setShowSitemapModal(false)}
              >
                <div 
                  className="glass rounded-2xl p-8 max-w-2xl w-full"
                  onClick={(e) => e.stopPropagation()}
                >
                  <div className="flex justify-between items-center mb-8">
                    <h3 className="text-3xl font-bold text-white">
                      <i className="fas fa-sitemap mr-3 text-blue-400"></i>
                      Generate Sitemap
                    </h3>
                    <button
                      onClick={() => setShowSitemapModal(false)}
                      className="text-gray-400 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg"
                    >
                      <i className="fas fa-times text-2xl"></i>
                    </button>
                  </div>

                  {/* Sitemap Type Selection */}
                  <div className="mb-8">
                    <label className="block text-lg font-semibold text-gray-200 mb-4">
                      <i className="fas fa-filter mr-2 text-purple-400"></i>
                      URL Selection
                    </label>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <button
                        onClick={() => setSitemapOptions({...sitemapOptions, type: 'all'})}
                        className={`px-6 py-4 rounded-xl font-medium transition-all text-left border-2 ${
                          sitemapOptions.type === 'all'
                            ? 'bg-purple-600 text-white border-purple-400 shadow-lg shadow-purple-500/30'
                            : 'bg-white/5 text-gray-300 border-white/10 hover:bg-white/10 hover:border-white/20'
                        }`}
                      >
                        <i className="fas fa-globe text-2xl mb-2 block"></i>
                        <div className="font-bold text-lg">All URLs</div>
                        <div className="text-sm opacity-75 mt-1">{linkCounts.all > 0 ? `${linkCounts.all} pages` : 'Include all discovered pages'}</div>
                      </button>
                      <button
                        onClick={() => setSitemapOptions({...sitemapOptions, type: 'healthy'})}
                        className={`px-6 py-4 rounded-xl font-medium transition-all text-left border-2 ${
                          sitemapOptions.type === 'healthy'
                            ? 'bg-green-600 text-white border-green-400 shadow-lg shadow-green-500/30'
                            : 'bg-white/5 text-gray-300 border-white/10 hover:bg-white/10 hover:border-white/20'
                        }`}
                      >
                        <i className="fas fa-check-circle text-2xl mb-2 block"></i>
                        <div className="font-bold text-lg">Healthy Links Only</div>
                        <div className="text-sm opacity-75 mt-1">{linkCounts.healthy > 0 ? `${linkCounts.healthy} pages` : 'Only successful pages'}</div>
                      </button>
                    </div>
                  </div>

                  {/* Priority Strategy Selection */}
                  <div className="mb-8">
                    <label className="block text-lg font-semibold text-gray-200 mb-4">
                      <i className="fas fa-sort-amount-down mr-2 text-purple-400"></i>
                      Priority Strategy
                    </label>
                    <div className="space-y-3">
                      <button
                        onClick={() => setSitemapOptions({...sitemapOptions, priority: 'manual'})}
                        className={`w-full px-6 py-4 rounded-xl font-medium transition-all text-left border-2 ${
                          sitemapOptions.priority === 'manual'
                            ? 'bg-purple-600 text-white border-purple-400 shadow-lg shadow-purple-500/30'
                            : 'bg-white/5 text-gray-300 border-white/10 hover:bg-white/10 hover:border-white/20'
                        }`}
                      >
                        <div className="flex items-start gap-4">
                          <i className="fas fa-equals text-2xl mt-1"></i>
                          <div className="flex-1">
                            <div className="font-bold text-lg">Manual Priority</div>
                            <div className="text-sm opacity-75 mt-1">All pages receive equal priority value of 0.5</div>
                          </div>
                        </div>
                      </button>
                      <button
                        onClick={() => setSitemapOptions({...sitemapOptions, priority: 'intelligent'})}
                        className={`w-full px-6 py-4 rounded-xl font-medium transition-all text-left border-2 ${
                          sitemapOptions.priority === 'intelligent'
                            ? 'bg-purple-600 text-white border-purple-400 shadow-lg shadow-purple-500/30'
                            : 'bg-white/5 text-gray-300 border-white/10 hover:bg-white/10 hover:border-white/20'
                        }`}
                      >
                        <div className="flex items-start gap-4">
                          <i className="fas fa-brain text-2xl mt-1"></i>
                          <div className="flex-1">
                            <div className="font-bold text-lg">Intelligent Priority</div>
                            <div className="text-sm opacity-75 mt-1">Parent pages and important sections get higher priority (0.6-1.0)</div>
                          </div>
                        </div>
                      </button>
                    </div>
                  </div>

                  {/* Actions */}
                  <div className="flex gap-4">
                    <button
                      onClick={() => setShowSitemapModal(false)}
                      className="flex-1 px-6 py-4 bg-white/5 hover:bg-white/10 text-gray-300 rounded-xl font-semibold transition-all border border-white/10"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={generateSitemap}
                      className="flex-1 px-6 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all shadow-lg shadow-blue-500/30"
                    >
                      <i className="fas fa-download mr-2"></i>
                      Generate Sitemap
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Schedule Scans Modal (Coming Soon) */}
            {showScheduleModal && (
              <div 
                className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50"
                onClick={() => setShowScheduleModal(false)}
              >
                <div 
                  className="glass rounded-2xl p-8 max-w-lg w-full"
                  onClick={(e) => e.stopPropagation()}
                >
                  <div className="flex justify-between items-center mb-6">
                    <h3 className="text-3xl font-bold text-white">
                      <i className="fas fa-calendar-alt mr-3 text-orange-400"></i>
                      Schedule Scans
                    </h3>
                    <button
                      onClick={() => setShowScheduleModal(false)}
                      className="text-gray-400 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg"
                    >
                      <i className="fas fa-times text-2xl"></i>
                    </button>
                  </div>

                  <div className="text-center py-8">
                    <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-orange-500 to-amber-500 rounded-full mb-6 shadow-lg shadow-orange-500/30">
                      <i className="fas fa-rocket text-4xl text-white"></i>
                    </div>
                    
                    <h4 className="text-2xl font-bold text-white mb-4">Coming Soon!</h4>
                    <p className="text-gray-300 mb-8 text-lg">This feature is currently under development and will be available in the next update.</p>
                    
                    <div className="bg-white/5 rounded-xl p-6 mb-6 border border-white/10">
                      <h5 className="text-lg font-semibold text-white mb-4 flex items-center justify-center">
                        <i className="fas fa-sparkles mr-2 text-yellow-400"></i>
                        Upcoming Features
                      </h5>
                      <ul className="text-left space-y-3 text-gray-300">
                        <li className="flex items-start">
                          <i className="fas fa-check text-green-400 mr-3 mt-1"></i>
                          <span>Daily, weekly, or monthly scan schedules</span>
                        </li>
                        <li className="flex items-start">
                          <i className="fas fa-check text-green-400 mr-3 mt-1"></i>
                          <span>Automated email reports with detailed insights</span>
                        </li>
                        <li className="flex items-start">
                          <i className="fas fa-check text-green-400 mr-3 mt-1"></i>
                          <span>Change detection alerts for broken links</span>
                        </li>
                        <li className="flex items-start">
                          <i className="fas fa-check text-green-400 mr-3 mt-1"></i>
                          <span>Custom notification preferences</span>
                        </li>
                      </ul>
                    </div>

                    <button
                      onClick={() => setShowScheduleModal(false)}
                      className="px-8 py-4 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-700 hover:to-amber-700 text-white rounded-xl font-semibold transition-all shadow-lg shadow-orange-500/30"
                    >
                      Got it, thanks!
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
